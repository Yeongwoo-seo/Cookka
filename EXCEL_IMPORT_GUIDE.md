# 엑셀 파일 Firebase 업로드 가이드

엑셀 파일의 데이터를 Firebase에 일괄 업로드하는 방법입니다.

## 설치

먼저 필요한 라이브러리를 설치하세요:

```bash
npm install
```

## 사용 방법

### 1. 엑셀 파일 준비

프로젝트 루트에 `data` 폴더를 만들고 엑셀 파일을 넣으세요.

### 2. 재료 데이터 업로드

```bash
npm run import-excel -- --type=ingredient --file=data/ingredients.xlsx
```

**엑셀 파일 형식 (재료):**

**기본 형식 (재료만):**
| 재료명 | 수량 | 단위 | 원가 | 카테고리 |
|--------|------|------|------|----------|
| 맛술 | 0 | g | 1.99 | 조미료 |
| 된장 | 0 | g | 2.50 | 조미료 |
| 돼지고기 | 0 | g | 8.99 | 육류 |

**고급 형식 (재료 + 제품 정보 자동 통합):**
| 재료명 | 카테고리 | 재료원가 | 제품명 | 공급처 | 중량 | 금액 | 제품원가 | 메인제품 |
|--------|----------|----------|--------|--------|------|------|----------|----------|
| 맛술 | 조미료 | 1.99 | 맛술 500ml | 마트A | 500 | 0.995 | 1.99 | 예 |
| 맛술 | 조미료 | | 맛술 1L | 마트B | 1000 | 2.10 | 2.10 | |
| 된장 | 조미료 | 2.50 | 된장 500g | 마트A | 500 | 1.25 | 2.50 | 예 |

**중요**: 
- **재료원가** (`재료원가` 또는 `costPerUnit`): 재료 전체의 기본 원가 ($/kg)
- **제품원가** (`제품원가` 또는 `productCostPerUnit`): 각 제품의 원가 ($/kg)
  - 제품원가가 없으면 `금액 / 중량`으로 자동 계산
  - 제품원가가 없고 재료원가만 있으면 재료원가 사용
- **제품명**과 **공급처**는 필수입니다
- 중량과 금액은 선택사항입니다 (없으면 0으로 저장됨)
- 같은 재료명을 가진 여러 행이 있으면 각 행이 하나의 제품이 됩니다

**컬럼명 (한글 또는 영문 모두 가능):**
- 재료명 / name / ingredient
- 수량 / quantity (기본값: 0)
- 단위 / unit (기본값: g)
- 재료원가 / costPerUnit / 원가 / 단가 (**재료 레벨 원가**, $/kg 단위, 예: 1.99)
- 카테고리 / category (조미료, 육류, 채소, 곡물, 기타)
- 제품명 / productName (선택, 제품 정보가 있으면 자동으로 products 배열에 추가)
- 공급처 / supplier (선택, 제품 정보와 함께 사용)
- 중량 / weight (선택, 제품 정보와 함께 사용, g 단위)
- 금액 / price (선택, 제품 정보와 함께 사용, $ 단위)
- 제품원가 / productCostPerUnit (**제품 레벨 원가**, $/kg 단위, 없으면 금액/중량으로 계산)
- 메인제품 / isMain (선택, Y/예/true면 메인 제품으로 표시)

**원가 구별:**
- **재료원가**: 재료 전체의 기본 원가 (제품 정보가 없는 행에서 사용)
- **제품원가**: 각 제품의 원가 (제품 정보가 있는 행에서 사용)
- 제품원가가 없으면 `금액 / 중량`으로 자동 계산

**자동 통합 기능:**
- 같은 재료명을 가진 여러 행이 있으면 **자동으로 하나의 재료로 통합**됩니다
- 각 행의 제품 정보(제품명, 공급처, 중량, 금액)는 `products` 배열에 자동으로 추가됩니다
- 예: "맛술"이 2행 있으면 → 1개 재료로 통합, products 배열에 2개 제품 정보 추가

### 3. 재고 데이터 업로드

```bash
npm run import-excel -- --type=inventory --file=data/inventory.xlsx
```

**엑셀 파일 형식 (재고):**

| 재고명 | 재고량 | 단위 | 원가 | 적정재고 | 위치 | 유통기한 |
|--------|--------|------|------|----------|------|----------|
| 맛술 | 500 | g | 5000 | 200 | 창고A | 2025-12-31 |
| 된장 | 1000 | g | 8000 | 500 | 창고B | 2026-01-15 |

**컬럼명 (한글 또는 영문 모두 가능):**
- 재고명 / name
- 재고량 / currentStock / 수량
- 단위 / unit
- 원가 / costPerUnit / 단가 (**$/kg 단위로 입력**, 예: 1.99)
- 적정재고 / minimumStock / 최소재고
- 위치 / location / 창고위치 (선택)
- 유통기한 / expirationDate (선택)

### 4. 레시피 데이터 업로드

```bash
npm run import-excel -- --type=recipe --file=data/recipes.xlsx
```

**엑셀 파일 형식 (레시피):**

| 레시피명 | 카테고리 | 기준인분 | 재료명 | 재료량 | 재료단위 | 단계 | 단계순서 |
|----------|----------|----------|--------|--------|----------|------|----------|
| 된장찌개 | 국 | 4 | 된장 | 50 | g | 된장을 풀어주세요 | 1 |
| 된장찌개 | 국 | 4 | 두부 | 200 | g | 두부를 넣어주세요 | 2 |
| 된장찌개 | 국 | 4 | 대파 | 50 | g | 대파를 넣어주세요 | 3 |

**컬럼명 (한글 또는 영문 모두 가능):**
- 레시피명 / name / recipeName
- 카테고리 / category (밥, 메인 요리, 사이드 요리, 기본 반찬, 국)
- 기준인분 / baseServings
- 재료명 / ingredient / ingredientName
- 재료량 / quantity
- 재료단위 / unit
- 단계 / step / 조리단계 / description
- 단계순서 / stepOrder / order (선택, 없으면 자동 증가)

## 주의사항

1. **환경 변수 확인**: `.env.local` 파일에 Firebase 설정이 있어야 합니다.
2. **파일 경로**: 엑셀 파일 경로는 프로젝트 루트 기준 상대 경로입니다.
3. **데이터 형식**: 숫자는 숫자 형식으로, 날짜는 날짜 형식으로 입력하세요.
4. **중복 처리**: 같은 ID가 있으면 기존 데이터를 업데이트합니다 (merge).

## 예시

### 재료 데이터 예시 (ingredients.xlsx)

```
재료명   | 수량 | 단위 | 원가   | 카테고리
맛술     | 0    | g    | 1.99   | 조미료
된장     | 0    | g    | 2.50   | 조미료
돼지고기 | 0    | g    | 8.99   | 육류
```

**참고**: 원가는 **$/kg 단위**로 입력하세요. 예를 들어 1kg에 $1.99면 `1.99`로 입력합니다.

### 재고 데이터 예시 (inventory.xlsx)

```
재고명 | 재고량 | 단위 | 원가 | 적정재고
맛술   | 500    | g    | 1.99 | 200
된장   | 1000   | g    | 2.50 | 500
```

**참고**: 원가는 **$/kg 단위**로 입력하세요. 예를 들어 1kg에 $1.99면 `1.99`로 입력합니다.

### 레시피 데이터 예시 (recipes.xlsx)

```
레시피명   | 카테고리 | 기준인분 | 재료명 | 재료량 | 재료단위 | 단계
된장찌개   | 국       | 4       | 된장   | 50     | g        | 된장을 풀어주세요
된장찌개   | 국       | 4       | 두부   | 200    | g        | 두부를 넣어주세요
```

## 문제 해결

- **파일을 찾을 수 없습니다**: 파일 경로를 확인하세요.
- **Firebase 오류**: `.env.local` 파일의 Firebase 설정을 확인하세요.
- **데이터 형식 오류**: 엑셀 파일의 데이터 형식을 확인하세요.
